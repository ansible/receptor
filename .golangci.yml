---
run:
  timeout: 10m

linters:
  disable-all: true
  enable:
    # - asasalint # TODO: Check for pass []any as any in variadic func(...any)
    - asciicheck
    # - bidichk # TODO: Checks for dangerous unicode character sequences
    - bodyclose
    # - containedctx # TODO: Containedctx is a linter that detects struct contained context.Context field
    # - contextcheck # TODO: Check whether the function uses a non-inherited context
    # - copyloopvar # TODO: Copyloopvar is a linter detects places where loop variables are copied
    # - cyclop # TODO: Reduce code complexity
    # - decorder # TODO: Check declaration order and count of types, constants, variables and functions
    - depguard
    - dogsled
    # - dupl # TODO: Remove duplicates
    # - dupword # TODO: Checks for duplicate words in the source code
    - durationcheck
    # - errcheck # TODO: Errcheck is a program for checking for unchecked errors in Go code. These unchecked errors can be critical bugs in some cases
    # - errchkjson # TODO: Checks types passed to the json encoding functions. Reports unsupported types and reports occations, where the check for the returned error can be omitted
    # - errname # TODO: Checks that sentinel errors are prefixed with the Err and error types are suffixed with the Error
    # - errorlint # TODO: Use errors package.
    # - execinquery # TODO: Execinquery is a linter about query string checker in Query function which reads your Go src files and warning it finds
    # - exhaustive # TODO: Check exhaustiveness of enum switch statements
    # - exhauststruct # TODO: Checks if all structure fields are initialized
    - exportloopref
    # - forbidgo # TODO: Forbids identifiers
    # - forcetypeassert # TODO: always assert types when when casting
    # - funlen # TODO: Reduce code complexity
    - gci
    # - ginkgolinter # TODO: Enforces standards of using ginkgo and gomega
    # - gocheckcompilerdirectives # TODO: Checks that go compiler directive comments (//go:) are valid
    # - gochecknoglobals # TODO: Reduce number of globals
    # - gochecknoinits # TODO: Maybe not use init()
    # - gochecksumtype # TODO: Run exhaustiveness checks on Go "sum types" 
    # - gocognit # TODO: Reduce code complexity
    # - goconst # TODO: Finds repeated strings that could be replaced by a constant
    - gocritic
    # - gocyclo # TODO: Reduce code complexity
    - godot
    # - godox # TODO: Tool for detection of FIXME, TODO and other comment keywords
    # - goerr113 # TODO: Please do not use dynamic errors.
    - gofmt
    - gofumpt
    - goheader
    - goimports
    # - gomnd # TODO: An analyzer to detect magic numbers
    - gomoddirectives
    - gomodguard
    # - goprintffuncname # TODO: logging methods are not named like the ones in `fmt` which could lead to problems.
    - gosec
    - gosimple
    # - gosmopolitan # TODO: Report certain i18n/l10n anti-patterns in your Go codebase
    - govet
    # - grouper # TODO: Analyze expression groups
    - importas
    # - inamedparam # TODO: Reports interfaces with unnamed method parameters
    - ineffassign
    # - interfacebloat # TODO: A linter that checks the number of methods inside an interface
    # - intrange # TODO: Intrange is a linter to find places where for loops could make use of an integer range
    # - ireturn # TODO: Accept Interfaces, Return Concrete Types
    # - lll # Reports long lines
    # - loggercheck # TODO: Checks key value pairs for common logger libraries (kitlog,klog,logr,zap)
    # - maintidx # TODO: Maintidx measures the maintainability index of each function
    - makezero
    # - mirror # TODO: Reports wrong mirror patterns of bytes/strings usage
    - misspell
    # - musttag # TODO: Enforce field tags in (un)marshaled structs
    - nakedret
    # - nestif # TODO: Reduce code complexity.
    - nilerr
    # - nilnil # TODO: Checks that there is no simultaneous return of nil error and an invalid value
    - nlreturn
    - noctx
    - nolintlint
    # nonamedreturns # TODO: Reports all named returns
    # nosprintfhostport # TODO: Checks for misuse of Sprintf to construct a host with port in a URL
    # - paralleltest # TODO: missing at some locations
    # - perfsprint # TODO: Checks that fmt.Sprintf can be replaced with a faster alternative
    - prealloc
    - predeclared
    # - promlinter # TODO: Check Prometheus metrics naming via promlint
    # - protogetter # TODO: Reports direct reads from proto message fields when getters should be used
    # - reassign # TODO: Checks that package variables are not reassigned
    # - revive
    - rowserrcheck
    # - sloglint # TODO: Ensure consistent code style when using log/slog
    # - spancheck # TODO: Checks for mistakes with OpenTelemetry/Census spans
    - sqlclosecheck
    - staticcheck
    - stylecheck
    # - tagalign # TODO: Check that struct tags are well aligned
    # - tagliatelle # TODO: Checks the struct tags
    # - tenv # TODO: Tenv is analyzer that detects using os.Setenv instead of t.Setenv since Go1.17
    # - testableexamples # TODO: Linter checks if examples are testable (have an expected output)
    # - testifylint # TODO: Checks usage of github.com/stretchr/testify
    # - testpackage # TODO: Put tests in their dedicated test packages
    # - thelper # TODO: Requires test refactoring.
    - tparallel
    - typecheck
    - unconvert
    # - unparam # TODO: This breaks something, look at it!
    - unused
    # - usetdlibvars # TODO: A linter that detect the possibility to use variables/constants from the Go standard library
    # - varnamelen # TODO: Checks that the length of a variable's name matches its scope
    - wastedassign
    - whitespace
    # - wrapcheck # TODO: Errors passed upwards should be wrapped
    # - wsl # TODO: Add or remove empty lines
    # - zerologlint # TODO: Detects the wrong usage of zerolog that a user forgets to dispatch with Send or Msg.

linters-settings:
  depguard:
    rules:
      main:
        files:
          - "$all"
          - "!$test"
          - "!**/functional/**/*.go"
        allow:
          - "$gostd"
          - "github.com/ansible/receptor/internal/version"
          - "github.com/ansible/receptor/pkg"
          - "github.com/creack/pty"
          - "github.com/fsnotify/fsnotify"
          - "github.com/ghjm/cmdline"
          - "github.com/golang-jwt/jwt/v4"
          - "github.com/google/shlex"
          - "github.com/gorilla/websocket"
          - "github.com/jupp0r/go-priority-queue"
          - "github.com/minio/highwayhash"
          - "github.com/pbnjay/memory"
          - "github.com/quic-go/quic-go"
          - "github.com/rogpeppe/go-internal/lockedfile"
          - "github.com/songgao/water"
          - "github.com/vishvananda/netlink"
          - "k8s.io/api/core"
          - "k8s.io/apimachinery/pkg"
          - "k8s.io/client-go"
      tests:
        files:
          - "$test"
          - "**/functional/**/*.go"
        allow:
          - "$gostd"
          - "github.com/ansible/receptor/pkg"
          - "github.com/ansible/receptor/tests/utils"
          - "github.com/fortytw2/leaktest"
          - "github.com/fsnotify/fsnotify"
          - "github.com/gorilla/websocket"
          - "github.com/golang/mock/gomock"
          - "github.com/prep/socketpair"
          - "k8s.io/api/core/v1"
          - "k8s.io/apimachinery/pkg/api/errors"
          - "k8s.io/apimachinery/pkg/apis/meta/v1"
          - "k8s.io/apimachinery/pkg/fields"
          - "k8s.io/apimachinery/pkg/selection"
          - "k8s.io/apimachinery/pkg/watch"
          - "k8s.io/client-go/kubernetes"
          - "k8s.io/client-go/rest"
          - "k8s.io/client-go/tools/remotecommand"

issues:
  # Dont commit the following line.
  # It will make CI pass without telling you about errors.
  # fix: true
  exclude:
    - "lostcancel"  # TODO: Context is not canceled on multiple occasions. Needs more detailed work to be fixed.
    - "SA2002|thelper|testinggoroutine"  # TODO: Test interface used outside of its routine, tests need to be rewritten.
    - "G306"  # TODO: Restrict perms of touched files.
    - "G402|G404"  # TODO: Make TLS more secure.
    - "G204"  # gosec is throwing a fit, ignore.
...

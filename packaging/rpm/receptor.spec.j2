# Generated by go2rpm 1
%bcond_without check

Name:           receptor
Version:        {{ version }}
Release:        {{ release }}%{?dist}

# https://github.com/project-receptor/receptor
%global goipath         github.com/project-receptor/receptor

%gometa

%global common_description %{expand:
Project Receptor is a flexible multi-service relayer with remote execution and
orchestration capabilities linking controllers with executors across a mesh of
nodes.}

Summary:        Project Receptor is a flexible multi-service relayer with remote execution and orchestration capabilities linking controllers with executors across a mesh of nodes

# Upstream license specification: Apache-2.0
License:        ASL 2.0
URL:            %{gourl}
Source0:        https://%{goipath}/archive/%{version}/%{name}-%{version}.tar.gz

BuildRequires:  golang(github.com/creack/pty)
BuildRequires:  golang(github.com/fsnotify/fsnotify)
BuildRequires:  golang(github.com/google/shlex)
BuildRequires:  golang(github.com/gorilla/websocket)
BuildRequires:  golang(github.com/jupp0r/go-priority-queue)
BuildRequires:  golang(github.com/lucas-clemente/quic-go)
BuildRequires:  golang(github.com/minio/highwayhash)
BuildRequires:  golang(github.com/rogpeppe/go-internal/lockedfile)
BuildRequires:  golang(github.com/songgao/water)
BuildRequires:  golang(github.com/vishvananda/netlink)
BuildRequires:  golang(gopkg.in/yaml.v2)
BuildRequires:  golang-k8s-client-devel
BuildRequires:  golang-k8s-api-devel
BuildRequires:  golang-k8s-apimachinery-devel

%if %{with check}
# Tests
BuildRequires:  golang(github.com/fortytw2/leaktest)
%endif

Requires: systemd

%description
%{common_description}

%gopkg

%prep
%goprep

%build
for cmd in cmd/* ; do
  %gobuild -o %{gobuilddir}/bin/$(basename $cmd .go) $cmd
done
%{gobuilddir}/bin/receptor --bash-completion > %{gobuilddir}/receptor.completion

%install
%gopkginstall
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/
install -m 0755 -vd                     %{buildroot}%{_sysconfdir}/systemd/system
install -m 0644 -vp packaging/rpm/receptor.service %{buildroot}%{_sysconfdir}/systemd/system/receptor@.service
install -m 0755 -vd                     %{buildroot}%{_sysconfdir}/receptor
install -m 0644 -vp packaging/rpm/receptor.conf.example %{buildroot}%{_sysconfdir}/receptor/receptor.conf.example
install -m 0755 -vd                     %{buildroot}%{_datadir}/bash-completion/completions
install -m 0644 -vp %{gobuilddir}/receptor.completion %{buildroot}%{_datadir}/bash-completion/completions/receptor

%if %{with check}
%check
%gocheck
%endif

%files
%{_bindir}/*
%{_datadir}/bash-completion/completions/receptor
%{_sysconfdir}/receptor/receptor.conf.example
%{_sysconfdir}/systemd/system/receptor@.service

%gopkgfiles

